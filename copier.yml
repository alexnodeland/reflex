# Copier configuration for Reflex template
# Usage: copier copy gh:alexnodeland/reflex my-project
# Update: copier update (pulls upstream changes)

_min_copier_version: "9.0.0"
_subdirectory: ""
_answers_file: .copier-answers.yml

# Questions
project_name:
  type: str
  help: "What is your project name?"
  default: "my-agent"
  validator: "{% if not project_name %}Project name is required{% endif %}"

project_slug:
  type: str
  help: "Python package name (lowercase, underscores)"
  default: "{{ project_name | lower | replace('-', '_') | replace(' ', '_') }}"
  validator: "{% if not project_slug.isidentifier() %}Must be a valid Python identifier{% endif %}"

description:
  type: str
  help: "Short project description"
  default: "Event-driven AI agent built with Reflex"

author_name:
  type: str
  help: "Author name"
  default: ""

author_email:
  type: str
  help: "Author email"
  default: ""

github_username:
  type: str
  help: "GitHub username (for badges and links)"
  default: ""

include_examples:
  type: bool
  help: "Include example agents? (useful for learning)"
  default: false

include_docs:
  type: bool
  help: "Include MkDocs documentation?"
  default: false

include_claude_commands:
  type: bool
  help: "Include Claude Code commands and skills?"
  default: true

python_version:
  type: str
  help: "Minimum Python version"
  default: "3.11"
  choices:
    - "3.11"
    - "3.12"
    - "3.13"

# Exclude patterns based on answers
_exclude:
  - "copier.yml"
  - ".copier-answers.yml"
  - ".git"
  - ".github"
  - "__pycache__"
  - "*.pyc"
  - ".pytest_cache"
  - ".ruff_cache"
  - ".venv"
  - "venv"
  - "htmlcov"
  - ".coverage"
  - "pyproject.toml"  # Use pyproject.toml.jinja instead
  - "README.md"       # Use README.md.jinja instead
  - "{% if not include_examples %}examples{% endif %}"
  - "{% if not include_docs %}docs{% endif %}"
  - "{% if not include_docs %}mkdocs.yml{% endif %}"
  - "{% if not include_claude_commands %}.claude{% endif %}"
  - "CONTRIBUTING.md"
  - "CLAUDE.md"

# Post-generation tasks
_tasks:
  # Rename the package directory
  - "mv src/reflex src/{{ project_slug }}"
  # Update imports in Python files
  - >-
    find src tests -name '*.py' -exec sed -i 's/from reflex\./from {{ project_slug }}./g' {} +
  - >-
    find src tests -name '*.py' -exec sed -i 's/import reflex/import {{ project_slug }}/g' {} +
  # Update pyproject.toml known-first-party
  - >-
    sed -i 's/known-first-party = \["reflex"\]/known-first-party = ["{{ project_slug }}"]/g' pyproject.toml
  # Initialize git repo
  - "git init"
  - "git add ."
  - 'git commit -m "Initial commit from Reflex template"'

# Jinja settings
_jinja_extensions:
  - jinja2.ext.do
  - jinja2.ext.loopcontrols

_templates_suffix: .jinja

# Message shown after generation
_message_after_copy: |

  Your project "{{ project_name }}" has been created!

  Next steps:
    cd {{ project_name }}
    cp .env.example .env
    # Edit .env with your API keys
    docker compose up

  The agent is running at:
    - API: http://localhost:8000
    - WebSocket: ws://localhost:8000/ws
    - Docs: http://localhost:8000/docs

  {% if include_claude_commands %}
  Claude Code commands available:
    /new-event    - Scaffold a new event type
    /new-agent    - Scaffold a new agent
    /new-filter   - Scaffold a custom filter
    /new-trigger  - Scaffold a trigger
    /test         - Run tests
    /check        - Run full CI pipeline
  {% endif %}

  To pull upstream updates later:
    copier update

